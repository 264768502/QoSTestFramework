# http://vq.kt.agh.edu.pl//metrics.html
# yonghao.zhao@intel.com
# 2017.6.1

import os
from string import atoi
from itertools import islice

os.popen("ffmpeg -i ../../native/output/receive/%d.tiff -s 1280x720 -pix_fmt yuv420p ../../native/output/receive/rec.yuv")
os.popen("ffmpeg -i ../../native/output/receive/%d.tiff -s 1280x720  ../../native/output/receive/rec.avi")
cmd = "./mitsuLinuxMultithread" 
'''
yuv = "test_black_mosaic_1280*1024.yuv " 
width = "1280 "
height = "1024"
'''
yuv = "../../native/output/receive/rec.yuv" 
width = "1280"
height = "640"
os.popen("rm metricsResultsCSV.txt")
output = os.popen(cmd + " " + yuv + " " + width + " " + height, "r")
output.read()
f = open("metricsResultsCSV.txt")
lines = f.readlines()
list_line = []
for line in islice(lines, 1, None):
	line = line.strip()
	line = line.split("\t")
	tuple_line = tuple(line)
	list_line.append(tuple_line)

for frame in list_line:
	ID = frame[0]
	Blockiness = frame[1] 	# Greater value, less visible distortion. It's like mosaic
	SA = frame[2]
	Letterbox =  frame[3]   # Value 1 means that the entire frame is smooth (blackout).
	Pillarbox = frame[4]    # Value 1 means that the entire frame is smooth (blackout).
	Blockloss = frame[5]    # Greater value, more visible distortion
	Blur = frame[6] 		# Greater value, more visible distortion
	TA = frame[7]
	Blackout = frame[8]
	Freezing = frame[9]     # Greater value, greater distortion (in this case distortion occurs)
	Exposure = frame[10] 	# Greater value, greater exposure time
	Contrast = frame[11]    # Greater value, higher contrast
	Interlace = frame[12]   # Greater value, greater distortion
	Noise = frame[13]       # Greater value, greater distortion
	Slice = frame[14]
	Flickering = frame[15] 

	print "\n" + "Frame:" + ID
	print "Blockiness: " + Blockiness
	print "Blockloss: " + Blockloss
	print "Blur: " + Blur

#	if float(Blockiness) > 1.01:
#		print "Blockiness detected! " + Blockiness + "(<0.9 or >1.01)"
#	if float(Blockloss) > 5 :
#		print "Blockloss detected! " + Blockloss + "(>5)"
#	if float(Blur) > 5:
#		print "Blur detected! " + Blur + "(>5)"
#	if float(SA) > 60:
#		print "Spatial Activity detected! " + SA + "(>60)"

	if float(Letterbox) == 1 and float(Blackout) == 1:
		print "Blackout detected!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! "
		
#	if float(Pillarbox) != 0 :
#		print "Pillarbox detected! " + Pillarbox + "(!=0)"

	
#	if float(TA) > 20 :
#		print "Temporal Activity detected! " + TA + "(>20)"
#	if float(Blackout) == 1:
#		print "Blackout dectected! " + Blackout + "(!=0)"
#	if float(Freezing) != 0:
#		print "Freezing detected! " + Freezing + "(!=0)"
#	if float(Exposure) < 115 or float(Exposure) > 125:
#		print "Exposure detected! " + Exposure + "(<115 or 125)"
#	if float(Contrast) < 45 or float(Contrast) > 55:
#		print "Contrast detected! " + Contrast + "(<45 or >55)"
#	if float(Interlace) != 0:
#		print "Interlace detected! " + Interlace + "(!=0)"
	if float(Noise) >3.5:
		print "Noise detected!" + Noise + "(>3.5)"
#	if float(Slice) > 1000:
#		print "Indicator doesn't work"

	
